<!DOCTYPE html>
<html lang="es" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Serie AppQoE: TCP Optimization | NetWithAlex</title>
<meta name="keywords" content="">
<meta name="description" content="Descubre c√≥mo SD-WAN mejora el rendimiento de TCP. Conoce las principales t√©cnicas de optimizaci√≥n que aumentan el rendimiento de las aplicaciones y mejoran la experiencia del usuario.">
<meta name="author" content="Alex">
<link rel="canonical" href="http://localhost:1313/appqoe-opt-tcp/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.d6fcd20a4fb86efa4dfac8ec95da60244cc8871042183da1ef28e3a762ad79c8.css" integrity="sha256-1vzSCk&#43;4bvpN&#43;sjsldpgJEzIhxBCGD2h7yjjp2Ktecg=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/assets/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/appqoe-tcp-opt/">
<link rel="alternate" hreflang="es" href="http://localhost:1313/appqoe-opt-tcp/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="http://localhost:1313/appqoe-opt-tcp/">
  <meta property="og:site_name" content="NetWithAlex">
  <meta property="og:title" content="Serie AppQoE: TCP Optimization">
  <meta property="og:description" content="Descubre c√≥mo SD-WAN mejora el rendimiento de TCP. Conoce las principales t√©cnicas de optimizaci√≥n que aumentan el rendimiento de las aplicaciones y mejoran la experiencia del usuario.">
  <meta property="og:locale" content="es">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-04-01T14:20:31+00:00">
    <meta property="article:modified_time" content="2025-04-01T14:20:31+00:00">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Serie AppQoE: TCP Optimization">
<meta name="twitter:description" content="Descubre c√≥mo SD-WAN mejora el rendimiento de TCP. Conoce las principales t√©cnicas de optimizaci√≥n que aumentan el rendimiento de las aplicaciones y mejoran la experiencia del usuario.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/es/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Serie AppQoE: TCP Optimization",
      "item": "http://localhost:1313/appqoe-opt-tcp/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Serie AppQoE: TCP Optimization",
  "name": "Serie AppQoE: TCP Optimization",
  "description": "Descubre c√≥mo SD-WAN mejora el rendimiento de TCP. Conoce las principales t√©cnicas de optimizaci√≥n que aumentan el rendimiento de las aplicaciones y mejoran la experiencia del usuario.",
  "keywords": [
    
  ],
  "articleBody": "Introduction ¬øAlguna vez has usado una aplicaci√≥n que se siente demasiado lenta? Tal vez las videollamadas se congelan o un portal web tarda una eternidad en cargar. Estos (y otros) son signos de que tu red WAN podr√≠a estar teniendo problemas.\n¬øLa buena noticia? Cisco SD-WAN incluye un conjunto de tecnolog√≠as dise√±adas para mejorar el rendimiento en enlaces poco confiables o con alta latencia. En esta serie, desglosaremos tres funciones clave que pueden mejorar significativamente la experiencia de las aplicaciones en tu red: Optimizaci√≥n TCP, Forward Error Correction (FEC) y Duplicaci√≥n de Paquetes.\nEn este primer post, exploraremos la Optimizaci√≥n TCP: c√≥mo funciona, cu√°ndo utilizarla y por qu√© puede marcar una gran diferencia para tus usuarios, especialmente en conexiones con alta latencia.\nDescripci√≥n de la Soluci√≥n El objetivo de la Optimizaci√≥n TCP es ajustar finamente las conexiones TCP para mejorar su rendimiento. Esto es especialmente √∫til cuando hay enlaces con alta latencia involucrados.\nLos routers SD-WAN actuar√°n como proxies, lo que significa que interceptar√°n las conexiones TCP y las ajustar√°n para obtener un mejor desempe√±o. Veamos un ejemplo visua\nSin la optimizaci√≥n TCP, el cliente y el servidor establecer√°n una sesi√≥n TCP directamente entre ellos.\nCuando se utiliza la Optimizaci√≥n TCP, el Router 1 interceptar√° y terminar√° la conexi√≥n TCP proveniente del cliente y establecer√° una sesi√≥n TCP optimizada con el Router 2. De igual manera, el Router 2 crear√° una sesi√≥n TCP con el servidor.\nNota Todo este proceso es transparente para el cliente y el servidor, y los datos ser√°n almacenados en cach√© en los routers para mantener activas las sesiones.\nLos equipos IOS-XE SD-WAN usan el algoritmo BBR el cual utiliza informacion sobre RTT (Round Trip Time) and ancho de banda disponible para optimizar la conexi√≥n. Si te gustar√≠a profundizar en el tema te recomiendo ver este v√≠deo de Neal Cardwell.\nLa implementaci√≥n actual de Optimization TCP tiene definidos dos roles:\nController Node: Equipo que intercepta y distribuye el trafico al Service Node. Service Node: Motores de optimizaci√≥n para la aceleraci√≥n del tr√°fico. En un escenario de la vida real, la recomendaci√≥n es tener servicios de optimizaci√≥n en las sedes y en los Data Centers. Hay requerimientos diferentes basados en el volumen de tr√°fico que los equipos van a procesar. Te sugiero leer la Documentaci√≥n de Cisco para informarte sobre los requerimientos de hardware y m√°s.\nEn las sedes peque√±as, es com√∫n utilizar un Integrated Service Node, es decir, un solo equipo puede interceptar, distribuir y optimizar el tr√°fico. Por otro lado, en el Data Cetner, un cluster de External Service Nodes es necesario para para lograr un mayor rendimiento y distribuir vol√∫menes m√°s altos de tr√°fico entre los miembros del cluster.\nEn general, la Optimizaci√≥n TCP es un proceso intensivo para los dispositivos, por lo que es crucial confirmar los requisitos de la plataforma. Por ejemplo, mi entorno de demostraci√≥n cuenta con dos Catalyst 8000V con 8 CPUs y 16 GB de RAM, requisitos adecuados para una implementaci√≥n peque√±a.\nVeamos en la pr√°ctica qu√© efecto tiene la optimizaci√≥n TCP en el tr√°fico. Para demostrarlo, voy a tomar una captura de paquetes en el lado WAN con y sin optimizaci√≥n.\nWindow Scaling Sin Optimizaci√≥n Let‚Äôs see how the window scaling behaves without optimization\nNota como el window size se mantuvo estable alrededor de 1,000,000 Bytes despu√©s de aproximadamente 5 segundos\nWindow Scaling Con Optimizaci√≥n Veamos la misma informaci√≥n pero con la optimizaci√≥n activa.\nNota como el window size estuvo en constante cambio a lo largo de la sesi√≥n, recuper√°ndose r√°pida y agresivamente despu√©s de caer.\nPor qu√© es tan importante este par√°metro? Le ped√≠ a ChatGPT que lo explicar√° de una manera simple y concisa.\nLa ampliaci√≥n de ventana (window scaling) es crucial en redes con alta latencia o gran ancho de banda, ya que permite que TCP utilice una ventana de recepci√≥n m√°s grande, lo cual impacta directamente en la cantidad de bytes in flight (datos no confirmados) que el emisor puede enviar. Sin esta opci√≥n, el tama√±o m√°ximo de la ventana es de 65,535 bytes ‚Äîdemasiado peque√±o para enlaces de alta velocidad‚Äî lo que lleva a una infrautilizaci√≥n del enlace. Con window scaling, la ventana puede crecer hasta varios gigabytes, permitiendo al emisor mantener m√°s datos ‚Äúen vuelo‚Äù y sostener un alto rendimiento incluso con demoras.\nEn resumen, la sesi√≥n TCP se divide en tres segmentos, donde los routers que optimizan anuncian una mayor ampliaci√≥n de ventana (window scaling) y gestionan las conexiones con el cliente y el servidor. El tr√°fico ahora se rige por el algoritmo BBR para maximizar el rendimiento.\nConfiguraci√≥n Para configurar esta funcionalidad, se pueden utilizar Feature Templates o Configuration Groups (con la versi√≥n 20.15 o superior). En mi caso utilizar√© Configuration Groups y voy a tener Internal Service Nodes en ambos lados\nPara empezar, a√±ado la funcionalidad ‚ÄúApp QoE‚Äù en el Service Profile con la siguiente configuraci√≥n:\nService Node para hacer aceleraci√≥n Forwarder para actuar como Controller Node Esta es la configuraci√≥n que se enviar√° al equipo:\ninterface VirtualPortGroup2 no shutdown ip address 192.168.2.1 255.255.255.0 service-insertion appqoe ! service-insertion appnav-controller-group appqoe ACG-APPQOE appnav-controller 192.168.2.1 ! service-insertion service-node-group appqoe SNG-APPQOE service-node 192.168.2.2 ! service-insertion service-context appqoe/1 appnav-controller-group ACG-APPQOE service-node-group SNG-APPQOE cluster-type integrated-service-node enable vrf global ! El estatus debe ser ‚ÄúRunning‚Äù\nLisbon_10-1#show sdwan appqoe tcpopt status ========================================================== TCP-OPT Status ========================================================== Status ------ TCP OPT Operational State : RUNNING TCP Proxy Operational State : RUNNING A continuaci√≥n, creo una pol√≠tica de datos muy sencilla para hacer match del tr√°fico entre el cliente y el servidor y selecciono la acci√≥n de AppQoE Optimization y selecciono la casilla de TCP Optimization.\nvsmart_1# show running-config policy policy data-policy _VPN_10_AppQoE vpn-list VPN_10 sequence 1 match source-data-prefix-list BR10_172_16_10_0 destination-data-prefix-list DC_100_172_16_100_0 ! action accept tcp-optimization service-node-group SNG-APPQOE ! ! sequence 11 match source-data-prefix-list DC_100_172_16_100_0 destination-data-prefix-list BR10_172_16_10_0 ! action accept tcp-optimization service-node-group SNG-APPQOE ! ! default-action accept ! ! Nota la direcci√≥n en la cual se debe aplicar la pol√≠tica es ALL\nvsmart_1# show running-config apply-policy apply-policy site-list BR_10 data-policy _VPN_10_AppQoE all ! site-list DC_100 data-policy _VPN_10_AppQoE all ! ! Verificando la Optimizaci√≥n TCP In order to quickly confirm traffic is being optimized, we can enable On-Demand Troubleshooting and select a period of time.\nAlso, from the real-time information we can see the flow list.\nThe Services column indicates the TCP Optimization is applied to those flows.\nProbando el rendimiento de la Optimization TCP Para evaluar el impacto de la Optimizaci√≥n TCP, ejecut√© pruebas con iperf utilizando diferentes valores de latencia para observar en qu√© condiciones la funci√≥n ofrece mayores beneficios. Aunque no se trata de un entorno de laboratorio profesional, proporciona informaci√≥n valiosa sobre c√≥mo se comporta la optimizaci√≥n en la pr√°ctica.\nNota Mi tr√°fico de iperf no est√° encriptado. No es posible optimizar tr√°fico encriptado sin antes desencriptarlo a trav√©s de TLS/SSL Decryption\nAlgunos detalles adicionales:\nEl ancho de banda est√° topado a 250 Mbps en los routers. Utilizo 4 flujos en paralelo, cada uno simulando una descarga de 100 MB: iperf -c 172.16.100.11 -n 100MB -P 4 -i 15 -R\nPara mantener consistencia, corro cada prueba 5 veces, descarto el resultado m√°s alto y m√°s bajo y al final saco un promedio de los tres restantes.\nLa siguiente tabla muestra los resultados obtenidos:\nDelay TCP Opt BW (Mbps) Time (s) 0 Disabled 248 ~ 13 0 Enabled 121,6 ~ 27 50 Disabled 99,7 ~ 33 50 Enabled 124 ~ 26 100 Disabled 71 ~ 46 100 Enabled 131 ~ 25 150 Disabled 66 ~ 49 150 Enabled 125 ~ 26 200 Disabled 59 ~ 56 200 Enabled 131 ~ 25 250 Disabled 63 ~ 52 250 Enabled 126 ~ 26 Aqu√≠ hay una representaci√≥n visual de la misma informaci√≥n\nLo que puedo concluir de los resultados:\nCon un delay de 0 ms, la optimizaci√≥n reduce el rendimiento (121 Mbps frente a 248 Mbps), debido al procesamiento que introduce esta funcionalidad.\nA medida que aumenta el delay, la optimizaci√≥n mejora el rendimiento y reduce el tiempo de transferencia, lo cual ya es evidente a partir de un delay de 50 ms.\nEl rendimiento disminuye significativamente sin optimizaci√≥n TCP. El ancho de banda baja de 248 Mbps a 0 ms a ~59‚Äì63 Mbps con retrasos de 200‚Äì250 ms. El tiempo tambi√©n aumenta proporcionalmente.\nEl rendimiento se mantiene estable a trav√©s de diferentes valores de delay con optimizaci√≥n TCP. El rendimiento se mantiene alrededor de 125‚Äì131 Mbps incluso con retrasos altos. El tiempo de transferencia tambi√©n es consistente, alrededor de ~26s.\nConclusi√≥n La optimizaci√≥n TCP es altamente efectiva para mitigar el impacto de la latencia en el rendimiento de TCP. Si bien introduce algo de sobrecarga en condiciones de baja latencia, sus beneficios se vuelven m√°s evidentes a medida que aumenta el retraso. En escenarios con retrasos de 100 ms o m√°s, la optimizaci√≥n puede ayudar a duplicar el rendimiento y reducir el tiempo de transferencia. Si est√°s pensando en habilitarla, ten en cuenta que, dependiendo del modelo de router, obtendr√°s rendimientos diferentes.\nAdem√°s, esta funci√≥n no debe habilitarse para todo el tr√°fico, sino que debe activarse para una aplicaci√≥n espec√≠fica o un conjunto de aplicaciones que necesiten aceleraci√≥n. Finalmente, esta funci√≥n ofrece mayores beneficios en l√≠neas intercontinentales, transportes satelitales o enlaces de alta latencia similares.\n¬°Espero que esta publicaci√≥n haya sido √∫til y nos vemos en la pr√≥xima!\n",
  "wordCount" : "1540",
  "inLanguage": "es",
  "datePublished": "2025-04-01T14:20:31Z",
  "dateModified": "2025-04-01T14:20:31Z",
  "author":{
    "@type": "Person",
    "name": "Alex"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/appqoe-opt-tcp/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "NetWithAlex",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/assets/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/es/" accesskey="h" title="NetWithAlex (Alt + H)">NetWithAlex</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                    <li>
                        <a href="http://localhost:1313/" title="English"
                            aria-label="English">En</a>
                    </li>
                </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/es/" title="Inicio">
                    <span>Inicio</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/es/archives/" title="Archivo">
                    <span>Archivo</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/es/category/" title="Categor√≠as">
                    <span>Categor√≠as</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/es/sobre-mi/" title="Sobre m√≠">
                    <span>Sobre m√≠</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/es/search/" title="üîç">
                    <span>üîç</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/es/">Inicio</a>&nbsp;¬ª&nbsp;<a href="http://localhost:1313/es/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      Serie AppQoE: TCP Optimization
    </h1>
    <div class="post-meta"><span title='2025-04-01 14:20:31 +0000 +0000'>abril 1, 2025</span>&nbsp;¬∑&nbsp;8 min&nbsp;¬∑&nbsp;Alex&nbsp;|&nbsp;Traducciones:
<ul class="i18n_list">
    <li>
        <a href="http://localhost:1313/appqoe-tcp-opt/">En</a>
    </li>
</ul>

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Tabla de Contenidos</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#introduction" aria-label="Introduction">Introduction</a></li>
                <li>
                    <a href="#descripci%c3%b3n-de-la-soluci%c3%b3n" aria-label="Descripci√≥n de la Soluci√≥n">Descripci√≥n de la Soluci√≥n</a><ul>
                        
                <li>
                    <a href="#window-scaling-sin-optimizaci%c3%b3n" aria-label="Window Scaling Sin Optimizaci√≥n">Window Scaling Sin Optimizaci√≥n</a></li>
                <li>
                    <a href="#window-scaling-con-optimizaci%c3%b3n" aria-label="Window Scaling Con Optimizaci√≥n">Window Scaling Con Optimizaci√≥n</a></li></ul>
                </li>
                <li>
                    <a href="#configuraci%c3%b3n" aria-label="Configuraci√≥n">Configuraci√≥n</a></li>
                <li>
                    <a href="#verificando-la-optimizaci%c3%b3n-tcp" aria-label="Verificando la Optimizaci√≥n TCP">Verificando la Optimizaci√≥n TCP</a></li>
                <li>
                    <a href="#probando-el-rendimiento-de-la-optimization-tcp" aria-label="Probando el rendimiento de la Optimization TCP">Probando el rendimiento de la Optimization TCP</a></li>
                <li>
                    <a href="#conclusi%c3%b3n" aria-label="Conclusi√≥n">Conclusi√≥n</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="introduction">Introduction<a hidden class="anchor" aria-hidden="true" href="#introduction">#</a></h2>
<p>¬øAlguna vez has usado una aplicaci√≥n que se siente demasiado lenta? Tal vez las videollamadas se congelan o un portal web tarda una eternidad en cargar. Estos (y otros) son signos de que tu red WAN podr√≠a estar teniendo problemas.</p>
<p>¬øLa buena noticia? Cisco SD-WAN incluye un conjunto de tecnolog√≠as dise√±adas para mejorar el rendimiento en enlaces poco confiables o con alta latencia. En esta serie, desglosaremos tres funciones clave que pueden mejorar significativamente la experiencia de las aplicaciones en tu red: Optimizaci√≥n TCP, Forward Error Correction (FEC) y Duplicaci√≥n de Paquetes.</p>
<p>En este primer post, exploraremos la Optimizaci√≥n TCP: c√≥mo funciona, cu√°ndo utilizarla y por qu√© puede marcar una gran diferencia para tus usuarios, especialmente en conexiones con alta latencia.</p>
<h2 id="descripci√≥n-de-la-soluci√≥n">Descripci√≥n de la Soluci√≥n<a hidden class="anchor" aria-hidden="true" href="#descripci√≥n-de-la-soluci√≥n">#</a></h2>
<p>El objetivo de la Optimizaci√≥n TCP es ajustar finamente las conexiones TCP para mejorar su rendimiento. Esto es especialmente √∫til cuando hay enlaces con alta latencia involucrados.</p>
<p>Los routers SD-WAN actuar√°n como proxies, lo que significa que interceptar√°n las conexiones TCP y las ajustar√°n para obtener un mejor desempe√±o. Veamos un ejemplo visua</p>
<p><img loading="lazy" src="/wp-content/uploads/2025/04/tcp-opt-topo.png"></p>
<p>Sin la optimizaci√≥n TCP, el cliente y el servidor establecer√°n una sesi√≥n TCP directamente entre ellos.</p>
<p>Cuando se utiliza la Optimizaci√≥n TCP, el Router 1 interceptar√° y terminar√° la conexi√≥n TCP proveniente del cliente y establecer√° una sesi√≥n TCP optimizada con el Router 2. De igual manera, el Router 2 crear√° una sesi√≥n TCP con el servidor.</p>
<p><strong>Nota</strong> Todo este proceso es transparente para el cliente y el servidor, y los datos ser√°n almacenados en cach√© en los routers para mantener activas las sesiones.</p>
<p>Los equipos IOS-XE SD-WAN usan el algoritmo BBR el cual utiliza informacion sobre RTT (Round Trip Time) and ancho de banda disponible para optimizar la conexi√≥n. Si te gustar√≠a profundizar en el tema te recomiendo ver <a href="https://www.youtube.com/watch?v=VIX45zMMZG8&amp;t=1607s">este v√≠deo</a> de Neal Cardwell.</p>
<p>La implementaci√≥n actual de Optimization TCP tiene definidos dos roles:</p>
<ul>
<li><strong>Controller Node:</strong> Equipo que intercepta y distribuye el trafico al <em>Service Node</em>.</li>
<li><strong>Service Node:</strong> Motores de optimizaci√≥n para la aceleraci√≥n del tr√°fico.</li>
</ul>
<p>En un escenario de la vida real, la recomendaci√≥n es tener servicios de optimizaci√≥n en las sedes y en los Data Centers. Hay requerimientos diferentes basados en el volumen de tr√°fico que los equipos van a procesar. Te sugiero leer la <a href="https://www.cisco.com/c/en/us/td/docs/routers/sdwan/configuration/appqoe/ios-xe-17/appqoe-book-xe/m-tcp-optimization.html">Documentaci√≥n de Cisco</a> para informarte sobre los requerimientos de hardware y m√°s.</p>
<p>En las sedes peque√±as, es com√∫n utilizar un <em>Integrated Service Node</em>, es decir, un solo equipo puede interceptar, distribuir y optimizar el tr√°fico. Por otro lado, en el Data Cetner, un cluster de <a href="https://www.cisco.com/c/en/us/td/docs/routers/sdwan/configuration/appqoe/ios-xe-17/appqoe-book-xe/m-support-for-multiple-appqoe-service-nodes.html">External Service Nodes</a> es necesario para para lograr un mayor rendimiento y distribuir vol√∫menes m√°s altos de tr√°fico entre los miembros del cluster.</p>
<p>En general, la Optimizaci√≥n TCP es un proceso intensivo para los dispositivos, por lo que es crucial confirmar los requisitos de la plataforma. Por ejemplo, mi entorno de demostraci√≥n cuenta con dos Catalyst 8000V con 8 CPUs y 16 GB de RAM, requisitos adecuados para una implementaci√≥n peque√±a.</p>
<p>Veamos en la pr√°ctica qu√© efecto tiene la optimizaci√≥n TCP en el tr√°fico. Para demostrarlo, voy a tomar una captura de paquetes en el lado WAN con y sin optimizaci√≥n.</p>
<h3 id="window-scaling-sin-optimizaci√≥n">Window Scaling Sin Optimizaci√≥n<a hidden class="anchor" aria-hidden="true" href="#window-scaling-sin-optimizaci√≥n">#</a></h3>
<p>Let&rsquo;s see how the window scaling behaves without optimization</p>
<p><img loading="lazy" src="/wp-content/uploads/2025/04/router1-tcp-opt-disabled.png"></p>
<p>Nota como el <em>window size</em> se mantuvo estable alrededor de 1,000,000 Bytes despu√©s de aproximadamente 5 segundos</p>
<h3 id="window-scaling-con-optimizaci√≥n">Window Scaling Con Optimizaci√≥n<a hidden class="anchor" aria-hidden="true" href="#window-scaling-con-optimizaci√≥n">#</a></h3>
<p>Veamos la misma informaci√≥n pero con la optimizaci√≥n activa.</p>
<p><img loading="lazy" src="/wp-content/uploads/2025/04/router1-tcp-opt-enabled.png"></p>
<p>Nota como el <em>window size</em> estuvo en constante cambio a lo largo de la sesi√≥n, recuper√°ndose r√°pida y agresivamente despu√©s de caer.</p>
<p>Por qu√© es tan importante este par√°metro? Le ped√≠ a ChatGPT que lo explicar√° de una manera simple y concisa.</p>
<blockquote>
<p><em>La ampliaci√≥n de ventana (window scaling) es crucial en redes con alta latencia o gran ancho de banda, ya que permite que TCP utilice una ventana de recepci√≥n m√°s grande, lo cual impacta directamente en la cantidad de bytes in flight (datos no confirmados) que el emisor puede enviar. Sin esta opci√≥n, el tama√±o m√°ximo de la ventana es de 65,535 bytes ‚Äîdemasiado peque√±o para enlaces de alta velocidad‚Äî lo que lleva a una infrautilizaci√≥n del enlace. Con window scaling, la ventana puede crecer hasta varios gigabytes, permitiendo al emisor mantener m√°s datos &ldquo;en vuelo&rdquo; y sostener un alto rendimiento incluso con demoras</em>.</p>
</blockquote>
<p>En resumen, la sesi√≥n TCP se divide en tres segmentos, donde los routers que optimizan anuncian una mayor ampliaci√≥n de ventana (window scaling) y gestionan las conexiones con el cliente y el servidor. El tr√°fico ahora se rige por el algoritmo BBR para maximizar el rendimiento.</p>
<h2 id="configuraci√≥n">Configuraci√≥n<a hidden class="anchor" aria-hidden="true" href="#configuraci√≥n">#</a></h2>
<p>Para configurar esta funcionalidad, se pueden utilizar <em>Feature Templates</em> o <em>Configuration Groups</em> (con la versi√≥n 20.15 o superior). En mi caso utilizar√© <em>Configuration Groups</em> y voy a tener <em>Internal Service Nodes</em> en ambos lados</p>
<p>Para empezar, a√±ado la funcionalidad &ldquo;App QoE&rdquo; en el <em>Service Profile</em> con la siguiente configuraci√≥n:</p>
<p><img loading="lazy" src="/wp-content/uploads/2025/04/tcp-opt-config.png"></p>
<ul>
<li><strong>Service Node</strong> para hacer aceleraci√≥n</li>
<li><strong>Forwarder</strong> para actuar como Controller Node</li>
</ul>
<p>Esta es la configuraci√≥n que se enviar√° al equipo:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>interface VirtualPortGroup2
</span></span><span style="display:flex;"><span>  no shutdown
</span></span><span style="display:flex;"><span>  ip address 192.168.2.1 255.255.255.0
</span></span><span style="display:flex;"><span>  service-insertion appqoe
</span></span><span style="display:flex;"><span>!
</span></span><span style="display:flex;"><span>service-insertion appnav-controller-group appqoe ACG-APPQOE
</span></span><span style="display:flex;"><span>  appnav-controller 192.168.2.1
</span></span><span style="display:flex;"><span>!
</span></span><span style="display:flex;"><span>service-insertion service-node-group appqoe SNG-APPQOE
</span></span><span style="display:flex;"><span>  service-node 192.168.2.2
</span></span><span style="display:flex;"><span>!
</span></span><span style="display:flex;"><span>service-insertion service-context appqoe/1
</span></span><span style="display:flex;"><span>  appnav-controller-group ACG-APPQOE
</span></span><span style="display:flex;"><span>  service-node-group      SNG-APPQOE
</span></span><span style="display:flex;"><span>  cluster-type            integrated-service-node
</span></span><span style="display:flex;"><span>  enable
</span></span><span style="display:flex;"><span>  vrf global
</span></span><span style="display:flex;"><span>!
</span></span></code></pre></div><p>El estatus debe ser <strong>&ldquo;Running&rdquo;</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>Lisbon_10-1#show sdwan appqoe tcpopt status 
</span></span><span style="display:flex;"><span>==========================================================
</span></span><span style="display:flex;"><span>                  TCP-OPT Status
</span></span><span style="display:flex;"><span>==========================================================
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Status
</span></span><span style="display:flex;"><span>------
</span></span><span style="display:flex;"><span>TCP OPT Operational State      : RUNNING
</span></span><span style="display:flex;"><span>TCP Proxy Operational State    : RUNNING
</span></span></code></pre></div><p>A continuaci√≥n, creo una pol√≠tica de datos muy sencilla para hacer match del tr√°fico entre el cliente y el servidor y selecciono la acci√≥n de <em>AppQoE Optimization</em> y selecciono la casilla de <em>TCP Optimization</em>.</p>
<p><img loading="lazy" src="/wp-content/uploads/2025/04/policy-config.png"></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>vsmart_1# show running-config policy 
</span></span><span style="display:flex;"><span>policy
</span></span><span style="display:flex;"><span> data-policy _VPN_10_AppQoE
</span></span><span style="display:flex;"><span>  vpn-list VPN_10
</span></span><span style="display:flex;"><span>   sequence 1
</span></span><span style="display:flex;"><span>    match
</span></span><span style="display:flex;"><span>     source-data-prefix-list      BR10_172_16_10_0
</span></span><span style="display:flex;"><span>     destination-data-prefix-list DC_100_172_16_100_0
</span></span><span style="display:flex;"><span>    !
</span></span><span style="display:flex;"><span>    action accept
</span></span><span style="display:flex;"><span>     tcp-optimization
</span></span><span style="display:flex;"><span>     service-node-group SNG-APPQOE
</span></span><span style="display:flex;"><span>    !
</span></span><span style="display:flex;"><span>   !
</span></span><span style="display:flex;"><span>   sequence 11
</span></span><span style="display:flex;"><span>    match
</span></span><span style="display:flex;"><span>     source-data-prefix-list      DC_100_172_16_100_0
</span></span><span style="display:flex;"><span>     destination-data-prefix-list BR10_172_16_10_0
</span></span><span style="display:flex;"><span>    !
</span></span><span style="display:flex;"><span>    action accept
</span></span><span style="display:flex;"><span>     tcp-optimization
</span></span><span style="display:flex;"><span>     service-node-group SNG-APPQOE
</span></span><span style="display:flex;"><span>    !
</span></span><span style="display:flex;"><span>   !
</span></span><span style="display:flex;"><span>   default-action accept
</span></span><span style="display:flex;"><span>  !
</span></span><span style="display:flex;"><span> !
</span></span></code></pre></div><p><strong>Nota</strong> la direcci√≥n en la cual se debe aplicar la pol√≠tica es <em>ALL</em></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>vsmart_1# show running-config apply-policy 
</span></span><span style="display:flex;"><span>apply-policy
</span></span><span style="display:flex;"><span> site-list BR_10
</span></span><span style="display:flex;"><span>  data-policy _VPN_10_AppQoE all
</span></span><span style="display:flex;"><span> !
</span></span><span style="display:flex;"><span> site-list DC_100
</span></span><span style="display:flex;"><span>  data-policy _VPN_10_AppQoE all
</span></span><span style="display:flex;"><span> !
</span></span><span style="display:flex;"><span>!
</span></span></code></pre></div><h2 id="verificando-la-optimizaci√≥n-tcp">Verificando la Optimizaci√≥n TCP<a hidden class="anchor" aria-hidden="true" href="#verificando-la-optimizaci√≥n-tcp">#</a></h2>
<p>In order to quickly confirm traffic is being optimized, we can enable On-Demand Troubleshooting and select a period of time.</p>
<p><img loading="lazy" src="/wp-content/uploads/2025/04/odt-tcp.png"></p>
<p>Also, from the real-time information we can see the flow list.</p>
<p><img loading="lazy" src="/wp-content/uploads/2025/04/rt-tcp.png"></p>
<p>The Services column indicates the TCP Optimization is applied to those flows.</p>
<h2 id="probando-el-rendimiento-de-la-optimization-tcp">Probando el rendimiento de la Optimization TCP<a hidden class="anchor" aria-hidden="true" href="#probando-el-rendimiento-de-la-optimization-tcp">#</a></h2>
<p>Para evaluar el impacto de la Optimizaci√≥n TCP, ejecut√© pruebas con iperf utilizando diferentes valores de latencia para observar en qu√© condiciones la funci√≥n ofrece mayores beneficios. Aunque no se trata de un entorno de laboratorio profesional, proporciona informaci√≥n valiosa sobre c√≥mo se comporta la optimizaci√≥n en la pr√°ctica.</p>
<p><strong>Nota</strong>  Mi tr√°fico de iperf no est√° encriptado. No es posible optimizar tr√°fico encriptado sin antes desencriptarlo a trav√©s de TLS/SSL Decryption</p>
<p>Algunos detalles adicionales:</p>
<ul>
<li>El ancho de banda est√° topado a <strong>250 Mbps</strong> en los routers.</li>
<li>Utilizo <strong>4 flujos en paralelo</strong>, cada uno simulando una descarga de <strong>100 MB</strong>:</li>
</ul>
<blockquote>
<p>iperf -c 172.16.100.11 -n 100MB -P 4 -i 15 -R</p>
</blockquote>
<p>Para mantener consistencia, corro cada prueba 5 veces, descarto el resultado m√°s alto y m√°s bajo y al final saco un promedio de los tres restantes.</p>
<p>La siguiente tabla muestra los resultados obtenidos:</p>
<table>
  <thead>
      <tr>
          <th>Delay</th>
          <th>TCP Opt</th>
          <th>BW (Mbps)</th>
          <th>Time (s)</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>0</td>
          <td>Disabled</td>
          <td>248</td>
          <td>~ 13</td>
      </tr>
      <tr>
          <td>0</td>
          <td>Enabled</td>
          <td>121,6</td>
          <td>~ 27</td>
      </tr>
      <tr>
          <td>50</td>
          <td>Disabled</td>
          <td>99,7</td>
          <td>~ 33</td>
      </tr>
      <tr>
          <td>50</td>
          <td>Enabled</td>
          <td>124</td>
          <td>~ 26</td>
      </tr>
      <tr>
          <td>100</td>
          <td>Disabled</td>
          <td>71</td>
          <td>~ 46</td>
      </tr>
      <tr>
          <td>100</td>
          <td>Enabled</td>
          <td>131</td>
          <td>~ 25</td>
      </tr>
      <tr>
          <td>150</td>
          <td>Disabled</td>
          <td>66</td>
          <td>~ 49</td>
      </tr>
      <tr>
          <td>150</td>
          <td>Enabled</td>
          <td>125</td>
          <td>~ 26</td>
      </tr>
      <tr>
          <td>200</td>
          <td>Disabled</td>
          <td>59</td>
          <td>~ 56</td>
      </tr>
      <tr>
          <td>200</td>
          <td>Enabled</td>
          <td>131</td>
          <td>~ 25</td>
      </tr>
      <tr>
          <td>250</td>
          <td>Disabled</td>
          <td>63</td>
          <td>~ 52</td>
      </tr>
      <tr>
          <td>250</td>
          <td>Enabled</td>
          <td>126</td>
          <td>~ 26</td>
      </tr>
  </tbody>
</table>
<p>Aqu√≠ hay una representaci√≥n visual de la misma informaci√≥n</p>
<p><img loading="lazy" src="/wp-content/uploads/2025/04/charts.png"></p>
<p>Lo que puedo concluir de los resultados:</p>
<ol>
<li>
<p>Con un delay de 0 ms, la optimizaci√≥n reduce el rendimiento (121 Mbps frente a 248 Mbps), debido al procesamiento que introduce esta funcionalidad.</p>
</li>
<li>
<p>A medida que aumenta el delay, la optimizaci√≥n mejora el rendimiento y reduce el tiempo de transferencia, lo cual ya es evidente a partir de un delay de 50 ms.</p>
</li>
<li>
<p>El rendimiento disminuye significativamente sin optimizaci√≥n TCP. El ancho de banda baja de 248 Mbps a 0 ms a ~59‚Äì63 Mbps con retrasos de 200‚Äì250 ms. El tiempo tambi√©n aumenta proporcionalmente.</p>
</li>
<li>
<p>El rendimiento se mantiene estable a trav√©s de diferentes valores de delay con optimizaci√≥n TCP. El rendimiento se mantiene alrededor de 125‚Äì131 Mbps incluso con retrasos altos. El tiempo de transferencia tambi√©n es consistente, alrededor de ~26s.</p>
</li>
</ol>
<h2 id="conclusi√≥n">Conclusi√≥n<a hidden class="anchor" aria-hidden="true" href="#conclusi√≥n">#</a></h2>
<p>La optimizaci√≥n TCP es altamente efectiva para mitigar el impacto de la latencia en el rendimiento de TCP. Si bien introduce algo de sobrecarga en condiciones de baja latencia, sus beneficios se vuelven m√°s evidentes a medida que aumenta el retraso. En escenarios con retrasos de 100 ms o m√°s, la optimizaci√≥n puede ayudar a duplicar el rendimiento y reducir el tiempo de transferencia. Si est√°s pensando en habilitarla, ten en cuenta que, dependiendo del modelo de router, obtendr√°s rendimientos diferentes.</p>
<p>Adem√°s, esta funci√≥n no debe habilitarse para todo el tr√°fico, sino que debe activarse para una aplicaci√≥n espec√≠fica o un conjunto de aplicaciones que necesiten aceleraci√≥n. Finalmente, esta funci√≥n ofrece mayores beneficios en l√≠neas intercontinentales, transportes satelitales o enlaces de alta latencia similares.</p>
<p>¬°Espero que esta publicaci√≥n haya sido √∫til y nos vemos en la pr√≥xima!</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/es/">NetWithAlex</a></span> ¬∑ 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copiar';

        function copyingDone() {
            copybutton.innerHTML = '¬°copiado!';
            setTimeout(() => {
                copybutton.innerHTML = 'copiar';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
