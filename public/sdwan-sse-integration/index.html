<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Securing the Edge with Cisco SD-WAN and Secure Access | NetWithAlex</title>
<meta name="keywords" content="">
<meta name="description" content="Discover how Cisco SD-WAN and Cisco Secure Access work together to enhance network performance and security in an internet first world.">
<meta name="author" content="alex">
<link rel="canonical" href="http://localhost:1313/sdwan-sse-integration/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.d6fcd20a4fb86efa4dfac8ec95da60244cc8871042183da1ef28e3a762ad79c8.css" integrity="sha256-1vzSCk&#43;4bvpN&#43;sjsldpgJEzIhxBCGD2h7yjjp2Ktecg=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/assets/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/sdwan-sse-integration/">
<link rel="alternate" hreflang="es" href="http://localhost:1313/sdwan-sse-integracion/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="http://localhost:1313/sdwan-sse-integration/">
  <meta property="og:site_name" content="NetWithAlex">
  <meta property="og:title" content="Securing the Edge with Cisco SD-WAN and Secure Access">
  <meta property="og:description" content="Discover how Cisco SD-WAN and Cisco Secure Access work together to enhance network performance and security in an internet first world.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-02-05T14:20:31+00:00">
    <meta property="article:modified_time" content="2025-02-05T14:20:31+00:00">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Securing the Edge with Cisco SD-WAN and Secure Access">
<meta name="twitter:description" content="Discover how Cisco SD-WAN and Cisco Secure Access work together to enhance network performance and security in an internet first world.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Securing the Edge with Cisco SD-WAN and Secure Access",
      "item": "http://localhost:1313/sdwan-sse-integration/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Securing the Edge with Cisco SD-WAN and Secure Access",
  "name": "Securing the Edge with Cisco SD-WAN and Secure Access",
  "description": "Discover how Cisco SD-WAN and Cisco Secure Access work together to enhance network performance and security in an internet first world.",
  "keywords": [
    
  ],
  "articleBody": "Introduction Security has always been a top of mind for organizations, but protecting every angle of the network remains a challenge. At the same time, ensuring an optimal application and user experience is equally important. Organizations have often had to choose between security-focused and performance-driven solutions, leading to increased management and operational complexity.\nCisco Secure Access is a robust solution that addresses these challenges. It offers top notch security by integrating advanced technologies and access controls. This means that users can get a secure and direct connectivity from SD-WAN sites to the internet and SaaS Apps.\nLet’s see how it works\nSD-WAN Meets Secure Access Starting with SD-WAN version 20.13/17.13, an integration with Secure Access is now available out of the box.\nWith this integration, automatic IPSec tunnels can be established to the primary and secondary Secure Access Data Centers closest to your router’s location, ensuring optimal performance. These tunnels route traffic while enforcing your organization’s security policies, providing a simple and powerful way to improve both security and connectivity.\nAt the core of Secure Access are Network Tunnel Groups (NTGs), which manage IPSec connections. Each NTG includes a primary and a secondary Secure Access Data Center. While configuring tunnels to both data centers is not mandatory, it is highly recommended to ensure high availability in case one becomes unavailable.\nIt is possible to configure up to 16 tunnels, 8 active and 8 backup, allowing for load balancing across active tunnels to increase the available bandwidth.\nTo automatically establish the tunnels, the SD-WAN Manager and router need internet connectivity and DNS lookup enabled. This allows the device to determine its own public ip address, communicate it to the Manager and get assigned the nearest primary and secondary SSE Data Centers.\nOnce the tunnels are established, traffic going through them will be secured by the core security features of SSE: FWaaS, CASB, ZTNA and SWG and more.\nConfiguration Steps Create API Key To start, on SSE create an API key for the Manager to securely connect. Make sure the following privileges are granted:\nDeployment / Network Tunnel Group - Read/Write Deployment / Tunnels - Read/Write Deployment / Regions - Read You will get your API Key and Key Secret\nEnter Credentials on the Manager Next, input the information on the SD-WAN Manager under Administration \u003e Settings \u003e Cloud Credentials \u003e SSE\nCreate SSE Policy on the Manager You need to create a new SSE Policy. This is where you input information about the IPSec tunnels.\nFrom Configuration \u003e Policy Groups \u003e Secure Service Edge\nThe following is the minimum you need:\nTracker IP - Used to confirm the tunnel is operational. Tunnel - At least 1 tunnel. Enter tunnel name, source interface and select primary/secondary DC Interface Pair - Specify active and backup tunnels. Select none as backup if there’s only 1 tunnel. Note You can select the SSE region of your preference or use Auto to automatically select it.\nThen, create a Policy Group, associate a device and add the SSE policy\nRedirect service side traffic Now, we need to redirect traffic from users to the tunnel. There are two options:\nService Route of type SSE On the Service VPN feature, add a Service Route with SSE Provider Cisco-Secure Access\nThis will be added in the following way:\nip sdwan route vrf 10 0.0.0.0/0 service sse Cisco-Secure-Access You can select what traffic gets forwarded to SSE by modifying the route, however this approach doesn’t give a lot of flexibility compared to the second option.\nData Policy Data Policies provide more flexibility to redirect traffic. We can not only match on the destination, but also on other useful elements such as source, applications and more.\nThis is an example matching all traffic coming from my VPN 10 users and setting an action of Secure Service Edge. Notice that we can enable the option to Fallback to routing in case tunnels are unavailable.\nValidations from the Manager Check the tunnel status from Monitor \u003e Tunnels \u003e SIG/SSE Tunnels\nLogs are available and are useful to determine if there are any issues forming the tunnels\nValidations from the User To verify that users are using SSE we have a couple of options\nThe first one is to visit policy.test.sse.com, if traffic is correctly redirected it will show something like this: On SSE side, there is a policy denying traffic to social media apps, let’s see the result of trying to access x.com\nLastly, accessing welcome.umbrella.com will let us know if user is protected\nAdditional considerations ECMP is available when multiple tunnels are active. Un-equal load balance can be achieved through weight assignment to IPSec tunnels. Fallback to routing is available when tunnels aren’t available Trackers are customizable - custom URL and thresholds to meet desired SLAs In-built dampening mechanism on tunnels to avoid flapping Data policy redirection provides greater flexibility than static sdwan routes Use Loopback interfaces to create multiple tunnels I hope you have learned something useful! See you on the next one 👋\n",
  "wordCount" : "832",
  "inLanguage": "en",
  "datePublished": "2025-02-05T14:20:31Z",
  "dateModified": "2025-02-05T14:20:31Z",
  "author":{
    "@type": "Person",
    "name": "alex"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/sdwan-sse-integration/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "NetWithAlex",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/assets/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="NetWithAlex (Alt + H)">NetWithAlex</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                    <li>
                        <a href="http://localhost:1313/es/" title="Español"
                            aria-label="Español">Es</a>
                    </li>
                </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/archives/" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/category/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about/" title="About me.">
                    <span>About me.</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="🔍">
                    <span>🔍</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;»&nbsp;<a href="http://localhost:1313/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      Securing the Edge with Cisco SD-WAN and Secure Access
    </h1>
    <div class="post-meta"><span title='2025-02-05 14:20:31 +0000 WET'>February 5, 2025</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;alex&nbsp;|&nbsp;Translations:
<ul class="i18n_list">
    <li>
        <a href="http://localhost:1313/sdwan-sse-integracion/">Es</a>
    </li>
</ul>

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#introduction" aria-label="Introduction">Introduction</a></li>
                <li>
                    <a href="#sd-wan-meets-secure-access" aria-label="SD-WAN Meets Secure Access">SD-WAN Meets Secure Access</a></li>
                <li>
                    <a href="#configuration-steps" aria-label="Configuration Steps">Configuration Steps</a><ul>
                        
                <li>
                    <a href="#create-api-key" aria-label="Create API Key">Create API Key</a></li>
                <li>
                    <a href="#enter-credentials-on-the-manager" aria-label="Enter Credentials on the Manager">Enter Credentials on the Manager</a></li>
                <li>
                    <a href="#create-sse-policy-on-the-manager" aria-label="Create SSE Policy on the Manager">Create SSE Policy on the Manager</a></li>
                <li>
                    <a href="#redirect-service-side-traffic" aria-label="Redirect service side traffic">Redirect service side traffic</a><ul>
                        
                <li>
                    <a href="#service-route-of-type-sse" aria-label="Service Route of type SSE">Service Route of type SSE</a></li>
                <li>
                    <a href="#data-policy" aria-label="Data Policy">Data Policy</a></li></ul>
                </li>
                <li>
                    <a href="#validations-from-the-manager" aria-label="Validations from the Manager">Validations from the Manager</a></li>
                <li>
                    <a href="#validations-from-the-user" aria-label="Validations from the User">Validations from the User</a></li></ul>
                </li>
                <li>
                    <a href="#additional-considerations" aria-label="Additional considerations">Additional considerations</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="introduction">Introduction<a hidden class="anchor" aria-hidden="true" href="#introduction">#</a></h2>
<p>Security has always been a top of mind for organizations, but protecting every angle of the network remains a challenge. At the same time, ensuring an optimal application and user experience is equally important. Organizations have often had to choose between security-focused and performance-driven solutions, leading to increased management and operational complexity.</p>
<p>Cisco Secure Access is a robust solution that addresses these challenges. It offers top notch security by integrating advanced technologies and access controls. This means that users can get a <em><strong>secure and direct</strong></em> connectivity from SD-WAN sites to the internet and SaaS Apps.</p>
<p>Let&rsquo;s see how it works</p>
<h2 id="sd-wan-meets-secure-access">SD-WAN Meets Secure Access<a hidden class="anchor" aria-hidden="true" href="#sd-wan-meets-secure-access">#</a></h2>
<p>Starting with SD-WAN version 20.13/17.13, an integration with Secure Access is now available out of the box.</p>
<p>With this integration, automatic IPSec tunnels can be established to the primary and secondary Secure Access Data Centers closest to your router’s location, ensuring optimal performance. These tunnels route traffic while enforcing your organization&rsquo;s security policies, providing a simple and powerful way to improve both security and connectivity.</p>
<p>At the core of Secure Access are <a href="https://docs.sse.cisco.com/sse-user-guide/docs/manage-network-tunnel-groups">Network Tunnel Groups (NTGs)</a>, which manage IPSec connections. Each NTG includes a primary and a secondary Secure Access Data Center. While configuring tunnels to both data centers is not mandatory, it is highly recommended to ensure high availability in case one becomes unavailable.</p>
<p><img loading="lazy" src="/wp-content/uploads/2025/02/sse-topo.png"></p>
<p>It is possible to configure up to 16 tunnels, 8 active and 8 backup, allowing for load balancing across active tunnels to increase the available bandwidth.</p>
<p>To <em>automatically</em> establish the tunnels, the SD-WAN Manager and router need internet connectivity and DNS lookup enabled. This allows the device to determine its own public ip address, communicate it to the Manager and get assigned the nearest primary and secondary SSE Data Centers.</p>
<p><img loading="lazy" src="/wp-content/uploads/2025/02/get-ip.png"></p>
<p>Once the tunnels are established, traffic going through them will be secured by the <a href="https://www.cisco.com/c/en/us/products/collateral/security/secure-access/hybrid-workforce-cloud-agile-security-ds.html#CiscoSecureAccessproductoverview">core security features of SSE</a>: FWaaS, CASB, ZTNA and SWG and more.</p>
<h2 id="configuration-steps">Configuration Steps<a hidden class="anchor" aria-hidden="true" href="#configuration-steps">#</a></h2>
<h3 id="create-api-key">Create API Key<a hidden class="anchor" aria-hidden="true" href="#create-api-key">#</a></h3>
<p>To start, on SSE <a href="https://docs.sse.cisco.com/sse-user-guide/docs/add-secure-access-api-keys">create an API key</a> for the Manager to securely connect. Make sure the following privileges are granted:</p>
<ul>
<li>Deployment / Network Tunnel Group - <strong>Read/Write</strong></li>
<li>Deployment / Tunnels - <strong>Read/Write</strong></li>
<li>Deployment / Regions - <strong>Read</strong></li>
</ul>
<p>You will get your <em>API Key and Key Secret</em></p>
<h3 id="enter-credentials-on-the-manager">Enter Credentials on the Manager<a hidden class="anchor" aria-hidden="true" href="#enter-credentials-on-the-manager">#</a></h3>
<p>Next, input the information on the SD-WAN Manager under <strong><em>Administration &gt; Settings &gt; Cloud Credentials &gt; SSE</em></strong></p>
<p><img loading="lazy" src="/wp-content/uploads/2025/02/sse-config.png"></p>
<h3 id="create-sse-policy-on-the-manager">Create SSE Policy on the Manager<a hidden class="anchor" aria-hidden="true" href="#create-sse-policy-on-the-manager">#</a></h3>
<p>You need to create a new SSE Policy. This is where you input information about the IPSec tunnels.</p>
<p>From <strong><em>Configuration &gt; Policy Groups &gt; Secure Service Edge</em></strong></p>
<p>The following is the minimum you need:</p>
<ul>
<li>Tracker IP - Used to confirm the tunnel is operational.</li>
<li>Tunnel - At least 1 tunnel. Enter <em>tunnel name, source interface</em> and select <em>primary/secondary DC</em></li>
<li>Interface Pair - Specify <em>active and backup tunnels</em>. Select <em>none</em> as backup if there&rsquo;s only 1 tunnel.</li>
</ul>
<p><strong>Note</strong> You can select the SSE region of your preference or use <em>Auto</em> to automatically select it.</p>
<p><img loading="lazy" src="/wp-content/uploads/2025/02/tunnel-config.png"></p>
<p>Then, create a Policy Group, associate a device and add the SSE policy</p>
<p><img loading="lazy" src="/wp-content/uploads/2025/02/policyg.png"></p>
<h3 id="redirect-service-side-traffic">Redirect service side traffic<a hidden class="anchor" aria-hidden="true" href="#redirect-service-side-traffic">#</a></h3>
<p>Now, we need to redirect traffic from users to the tunnel. There are two options:</p>
<h4 id="service-route-of-type-sse">Service Route of type SSE<a hidden class="anchor" aria-hidden="true" href="#service-route-of-type-sse">#</a></h4>
<p>On the <em>Service VPN</em> feature, add a <em>Service Route</em> with SSE Provider <strong><em>Cisco-Secure Access</em></strong></p>
<p><img loading="lazy" src="/wp-content/uploads/2025/02/static-sse.png"></p>
<p>This will be added in the following way:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>ip sdwan route vrf 10 0.0.0.0/0 service sse Cisco-Secure-Access
</span></span></code></pre></div><p>You can select what traffic gets forwarded to SSE by modifying the route, however this approach doesn&rsquo;t give a lot of flexibility compared to the second option.</p>
<h4 id="data-policy">Data Policy<a hidden class="anchor" aria-hidden="true" href="#data-policy">#</a></h4>
<p>Data Policies provide more flexibility to redirect traffic. We can not only match on the destination, but also on other useful elements such as source, applications and more.</p>
<p><img loading="lazy" src="/wp-content/uploads/2025/02/match-sse.png"></p>
<p>This is an example matching all traffic coming from my VPN 10 users and setting an action of Secure Service Edge. Notice that we can enable the option to <em>Fallback to routing</em> in case tunnels are unavailable.</p>
<p><img loading="lazy" src="/wp-content/uploads/2025/02/data-sse.png"></p>
<h3 id="validations-from-the-manager">Validations from the Manager<a hidden class="anchor" aria-hidden="true" href="#validations-from-the-manager">#</a></h3>
<p>Check the tunnel status from <strong><em>Monitor &gt; Tunnels &gt; SIG/SSE Tunnels</em></strong></p>
<p><img loading="lazy" src="/wp-content/uploads/2025/02/verify1.png"></p>
<p>Logs are available and are useful to determine if there are any issues forming the tunnels</p>
<p><img loading="lazy" src="/wp-content/uploads/2025/02/verify2.png"></p>
<h3 id="validations-from-the-user">Validations from the User<a hidden class="anchor" aria-hidden="true" href="#validations-from-the-user">#</a></h3>
<p>To verify that users are using SSE we have a couple of options</p>
<p>The first one is to visit policy.test.sse.com, if traffic is correctly redirected it will show something like this:
<img loading="lazy" src="/wp-content/uploads/2025/02/policy-sse.png"></p>
<p>On SSE side, there is a policy denying traffic to social media apps, let&rsquo;s see the result of trying to access x.com</p>
<p><img loading="lazy" src="/wp-content/uploads/2025/02/x-sse.png"></p>
<p>Lastly, accessing welcome.umbrella.com will let us know if user is protected</p>
<p><img loading="lazy" src="/wp-content/uploads/2025/02/umbrella-sse.png"></p>
<h2 id="additional-considerations">Additional considerations<a hidden class="anchor" aria-hidden="true" href="#additional-considerations">#</a></h2>
<ul>
<li>ECMP is available when multiple tunnels are active.</li>
<li>Un-equal load balance can be achieved through weight assignment to IPSec tunnels.</li>
<li>Fallback to routing is available when tunnels aren&rsquo;t available</li>
<li>Trackers are customizable - custom URL and thresholds to meet desired SLAs</li>
<li>In-built dampening mechanism on tunnels to avoid flapping</li>
<li>Data policy redirection provides greater flexibility than static sdwan routes</li>
<li>Use Loopback interfaces to create multiple tunnels</li>
</ul>
<p>I hope you have learned something useful! See you on the next one 👋</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
  </footer><script src="https://utteranc.es/client.js"
        repo="aruiz-p/netwithalex"
        issue-term="title"
        label="comments"
        theme="preferred-color-scheme"
        crossorigin="anonymous"
        async>
</script>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">NetWithAlex</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
