<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Simplifying AAR: 3/3 Fallback to best path | NetWithAlex</title>
<meta name="keywords" content="">
<meta name="description" content="Introduction
For the final post of this series, let&rsquo;s explore the remaining option to handle traffic when SLA is not met: Fallback to best path. It was introduced on 20.5/17.5 and it provides more flexibility and enhanced path selection compared to the other options. Let&rsquo;s understand why it was created.
Motivation
With the previous methods, traffic would either:

Be dropped - Rarely used, specific use cases that apply to a small amount of environments.
Be load balanced on the available paths - Widely used, however traffic could be using the worst performing path.

Take the following example">
<meta name="author" content="alex">
<link rel="canonical" href="http://localhost:1313/simplifying-aar-3-3-fallback-to-best-path/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.d6fcd20a4fb86efa4dfac8ec95da60244cc8871042183da1ef28e3a762ad79c8.css" integrity="sha256-1vzSCk&#43;4bvpN&#43;sjsldpgJEzIhxBCGD2h7yjjp2Ktecg=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/assets/favicon.ico">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/simplifying-aar-3-3-fallback-to-best-path/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="http://localhost:1313/simplifying-aar-3-3-fallback-to-best-path/">
  <meta property="og:site_name" content="NetWithAlex">
  <meta property="og:title" content="Simplifying AAR: 3/3 Fallback to best path">
  <meta property="og:description" content="Introduction For the final post of this series, let’s explore the remaining option to handle traffic when SLA is not met: Fallback to best path. It was introduced on 20.5/17.5 and it provides more flexibility and enhanced path selection compared to the other options. Let’s understand why it was created.
Motivation With the previous methods, traffic would either:
Be dropped - Rarely used, specific use cases that apply to a small amount of environments. Be load balanced on the available paths - Widely used, however traffic could be using the worst performing path. Take the following example">
  <meta property="og:locale" content="en-US">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-02-11T12:11:06+00:00">
    <meta property="article:modified_time" content="2024-02-11T12:11:06+00:00">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Simplifying AAR: 3/3 Fallback to best path">
<meta name="twitter:description" content="Introduction
For the final post of this series, let&rsquo;s explore the remaining option to handle traffic when SLA is not met: Fallback to best path. It was introduced on 20.5/17.5 and it provides more flexibility and enhanced path selection compared to the other options. Let&rsquo;s understand why it was created.
Motivation
With the previous methods, traffic would either:

Be dropped - Rarely used, specific use cases that apply to a small amount of environments.
Be load balanced on the available paths - Widely used, however traffic could be using the worst performing path.

Take the following example">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Simplifying AAR: 3/3 Fallback to best path",
      "item": "http://localhost:1313/simplifying-aar-3-3-fallback-to-best-path/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Simplifying AAR: 3/3 Fallback to best path",
  "name": "Simplifying AAR: 3\/3 Fallback to best path",
  "description": "Introduction For the final post of this series, let\u0026rsquo;s explore the remaining option to handle traffic when SLA is not met: Fallback to best path. It was introduced on 20.5/17.5 and it provides more flexibility and enhanced path selection compared to the other options. Let\u0026rsquo;s understand why it was created.\nMotivation With the previous methods, traffic would either:\nBe dropped - Rarely used, specific use cases that apply to a small amount of environments. Be load balanced on the available paths - Widely used, however traffic could be using the worst performing path. Take the following example\n",
  "keywords": [
    
  ],
  "articleBody": "Introduction For the final post of this series, let’s explore the remaining option to handle traffic when SLA is not met: Fallback to best path. It was introduced on 20.5/17.5 and it provides more flexibility and enhanced path selection compared to the other options. Let’s understand why it was created.\nMotivation With the previous methods, traffic would either:\nBe dropped - Rarely used, specific use cases that apply to a small amount of environments. Be load balanced on the available paths - Widely used, however traffic could be using the worst performing path. Take the following example\nTunnel 2 is clearly having the worst performance, however with the load balance method, traffic could still use it based on the hashing algorithm. How do we overcome this situation? You probably guessed it: Fallback to best path\nFallback to Best Path Let’s see how the documentation describes it:\nWhen the data traffic does not meet any of the SLA class requirements, this feature allows you to select the best tunnel path criteria sequence using the Fallback Best Tunnel.\nCisco SD-WAN Manager uses best of worst (BOW) to find a best tunnel when no tunnel meets any of the SLA class requirements.\nhttps://www.cisco.com/c/en/us/td/docs/routers/sdwan/configuration/policies/ios-xe-17/policies-book-xe/application-aware-routing.html\nBest of Worst Let’s see how BOW works with the following example:\nThe SLA latency requirement is set to 8. None of the tunnels satisfy it, but Tunnel 1 is the closest one, making it the best of worse with a latency of 10.\nThe criteria(s) to choose the BOW is extremely flexible, in this example we used latency, other options could be:\nlatency - Only latency jitter - Only jitter loss - Only loss latency/jitter - First latency, if they are equal, then jitter latency/loss - First latency, if they are equal, then loss jitter/latency - First jitter, if they are equal, then latency . . . loss/jitter/latency - First loss, then jitter, then latency Variance Let’s go a step further, Tunnel 3 is also very close to the 8 ms latency, it wouldn’t be a bad idea to send traffic also on that tunnel. How do we achieve this? Well, we can implement a variance to accommodate small variations when choosing the best paths.\nContinuing with this example, let’s take a look at the BOW selection with a variance of 5 ms.\nBOW range = (best latency, best latency + variance) BOW range = (10, 15) The best latency across tunnels is 10 (Tunnel 1), notice this is not the latency configured on the SLA. With this variance, if any other tunnel has a latency between 10 - 15, it will also be chosen to send traffic. In our example, Tunnel 3 satisfies the condition, so now Tunnel 1 and Tunnel 3 will be used as Fallback Tunnels.\nAs you can see, Tunnel 2 is no longer considered. Great!\nConfiguration SLA Class To use this method, the first thing we need to do is modify our sla-class to indicate that it should look for the best performing path when SLA is not met. Our configuration looks like this:\nsla-class Custom-SLA loss 1 latency 250 jitter 100 fallback-best-tunnel criteria loss loss-variance 2 Notice we selected the Criteria to be Loss and a variance of 2. Variance is an optional parameter.\nAAR Policy Next, on the AAR policy we specify the action when SLA is not met: Fallback to Best path\nsequence 1 match source-ip 172.16.10.0/24 destination-ip 172.16.20.0/24 action sla-class Custom-SLA no sla-class strict sla-class preferred-color mpls sla-class fallback-to-best-path Let’s keep the same dynamic and build a diagram:\nScenarios Using the same topology let’s explore some situations\nMPLS compliant, Biz-internet/Private1 non-compliant I will initiate traffic from Branch10 -\u003e Branch 20 and capture it with NWPI. MPLS has perfect KPI metrics (0, 0, 0)\nNotice how fallback to best path is set to no and traffic is matching the SLA and preferred color. Let’s also see the following verification command from BR10.\nBR10#show sdwan tunnel sla \u003c. . .\u003e tunnel sla-class 1 sla-name Custom-SLA sla-loss 1 sla-latency 250 sla-jitter 100 FALLBACK REMOTE T SLA SLA SRC DST SYSTEM LOCAL T REMOTE MEAN MEAN MEAN CLASS CLASS PROTO SRC IP DST IP PORT PORT IP COLOR COLOR LOSS LATENCY JITTER INDEX SLA CLASS NAME INDEX --------------------------------------------------------------------------------------------------------------------------------------------- gre 21.1.10.2 21.1.20.2 0 0 1.1.0.20 mpls mpls 0 0 0 0,1 __all_tunnels__, Custom-SLA None gre 21.1.10.2 31.1.20.2 0 0 1.1.0.20 mpls biz-internet 0 0 0 0,1 __all_tunnels__, Custom-SLA None gre 21.1.10.2 41.1.20.2 0 0 1.1.0.20 mpls private1 0 0 0 0,1 __all_tunnels__, Custom-SLA None Some comments about this output:\nThe fact that we see tunnels listed under Custom-SLA, tells us that there are tunnels meeting the loss, latency and jitter. This is expected as our MPLS is having perfect metrics. See that this sla-class has a numeric identifier of 1 - tunnel sla-class 1. You will see reference to this number shortly. Fallback SLA class index is set to none, this mean that these tunnels are not being used as fallback tunnels, this will become clear in a second. MPLS/Biz-inernet/Private1 non-compliant but meeting variance Now that we have no transports meeting the SLA, let’s check how NWPI will show it:\nNotice that now NWPI is indicating that Fallback to Best Path is in use.\nPrivate1 was chosen to send this particular flow, but are there any other tunnels that could be used? Let’s check BR10 again.\nBR10# show sdwan tunnel sla tunnel sla-class 0 sla-name __all_tunnels__ sla-loss 0 sla-latency 0 sla-jitter 0 FALLBACK REMOTE SLA SLA SRC DST SYSTEM T LOCAL T REMOTE MEAN MEAN MEAN CLASS CLASS PROTO SRC IP DST IP PORT PORT IP COLOR COLOR LOSS LATENCY JITTER INDEX SLA CLASS NAME INDEX ---------------------------------------------------------------------------------------------------------------------------------------- gre 21.1.10.2 21.1.20.2 0 0 1.1.0.20 mpls mpls 18 0 0 0 __all_tunnels__ None gre 21.1.10.2 31.1.20.2 0 0 1.1.0.20 mpls biz-internet 9 0 0 0 __all_tunnels__ None gre 21.1.10.2 41.1.20.2 0 0 1.1.0.20 mpls private1 11 0 0 0 __all_tunnels__ None gre 31.1.10.2 21.1.20.2 0 0 1.1.0.20 biz-internet mpls 4 0 0 0 __all_tunnels__ 1 gre 31.1.10.2 31.1.20.2 0 0 1.1.0.20 biz-internet biz-internet 2 0 0 0 __all_tunnels__ 1 gre 31.1.10.2 41.1.20.2 0 0 1.1.0.20 biz-internet private1 4 0 0 0 __all_tunnels__ 1 gre 41.1.10.2 21.1.20.2 0 0 1.1.0.20 private1 mpls 3 0 0 0 __all_tunnels__ 1 gre 41.1.10.2 31.1.20.2 0 0 1.1.0.20 private1 biz-internet 6 0 0 0 __all_tunnels__ None gre 41.1.10.2 41.1.20.2 0 0 1.1.0.20 private1 private1 3 0 0 0 __all_tunnels__ 1 tunnel sla-class 1 sla-name Custom-SLA sla-loss 1 sla-latency 250 sla-jitter 100 BR10# Comments about this output:\nThere are no tunnels meeting our Custom-SLA Even if MPLS is the preferred color, it is not considered because it doesn’t meet the loss variance range. There are 5 tunnels that satisfy the variance. Notice how some tunnels have Fallback SLA class index set to 1, meaning that they are serving as fallback for sla-class 1 (Custom-SLA). In this case the BOW is biz-internet - biz-internet tunnel with a mean loss of 2. The variance is set to 2, so BOW range is 2-4. Tunnels satisfying the BOW range, will be used to forward traffic as well. Depending on the load-balance hash, different tunnels will be chosen\nBR10#show sdwan policy service-path vpn 10 interface GigabitEthernet 3 source-ip 172.16.10.2 dest-ip 172.16.20.2 protocol 6 dest-port 22 Next Hop: GRE Source: 31.1.10.2 Destination: 21.1.20.2 Local Color: biz-internet Remote Color: mpls Remote System IP: 1.1.0.20 BR10#show sdwan policy service-path vpn 10 interface GigabitEthernet 3 source-ip 172.16.10.56 dest-ip 172.16.20.2 protocol 6 dest-port 24 Next Hop: GRE Source: 31.1.10.2 Destination: 41.1.20.2 Local Color: biz-internet Remote Color: private1 Remote System IP: 1.1.0.20 We can see two different tunnels biz-internet - mpls and biz-internet - private\nLatency out of compliance So far we have been playing only with loss, because the fallback criteria was set to loss. Let’s see what happens when a different criteria goes out of compliance. I will set the latency of the SLA to 15 ms. .\nBR10#show sdwan policy from-vsmart from-vsmart sla-class Custom-SLA loss 1 latency 15 jitter 100 fallback-best-tunnel criteria loss loss-variance 2 After introducing some latency, we see something interesting:\nBR10#show sdwan tunnel sla tunnel sla-class 0 sla-name __all_tunnels__ sla-loss 0 sla-latency 0 sla-jitter 0 FALLBACK REMOTE SLA SLA SRC DST SYSTEM T LOCAL T REMOTE MEAN MEAN MEAN CLASS CLASS PROTO SRC IP DST IP PORT PORT IP COLOR COLOR LOSS LATENCY JITTER INDEX SLA CLASS NAME INDEX ---------------------------------------------------------------------------------------------------------------------------------------- gre 21.1.10.2 21.1.20.2 0 0 1.1.0.20 mpls mpls 0 20 1 0 __all_tunnels__ 1 gre 21.1.10.2 31.1.20.2 0 0 1.1.0.20 mpls biz-internet 0 20 1 0 __all_tunnels__ 1 gre 21.1.10.2 41.1.20.2 0 0 1.1.0.20 mpls private1 0 20 0 0 __all_tunnels__ 1 gre 31.1.10.2 21.1.20.2 0 0 1.1.0.20 biz-internet mpls 0 21 2 0 __all_tunnels__ 1 gre 31.1.10.2 31.1.20.2 0 0 1.1.0.20 biz-internet biz-internet 0 21 2 0 __all_tunnels__ 1 gre 31.1.10.2 41.1.20.2 0 0 1.1.0.20 biz-internet private1 0 21 2 0 __all_tunnels__ 1 gre 41.1.10.2 21.1.20.2 0 0 1.1.0.20 private1 mpls 0 16 1 0 __all_tunnels__ 1 gre 41.1.10.2 31.1.20.2 0 0 1.1.0.20 private1 biz-internet 0 16 0 0 __all_tunnels__ 1 gre 41.1.10.2 41.1.20.2 0 0 1.1.0.20 private1 private1 0 16 0 0 __all_tunnels__ 1 tunnel sla-class 1 sla-name Custom-SLA sla-loss 1 sla-latency 15 sla-jitter 100 BR10# All of the tunnels are used as fallback tunnels because all of them have 0% loss! Is this the ideal situation? This is arguable, maybe for some types of traffic it’s fine, but for others you probably want to have a second or third criteria to pick the best fallback tunnels.\nMultiple BOW criteria For the last test, let’s see what happens when we select multiple criteria to select the BOW. I will add latency to the SLA criteria.\nBR10#show sdwan policy from-vsmart from-vsmart sla-class Custom-SLA loss 1 latency 15 jitter 100 fallback-best-tunnel criteria loss latency loss-variance 2 What we expect is that if any of the KPIs go out of compliance, the BOW will be decided based on:\nLowest mean loss. If there is a tie, then Lowest latency Let’s verify\nBR10#show sdwan tunnel sla tunnel sla-class 0 sla-name __all_tunnels__ sla-loss 0 sla-latency 0 sla-jitter 0 FALLBACK REMOTE SLA SLA SRC DST SYSTEM T LOCAL T REMOTE MEAN MEAN MEAN CLASS CLASS PROTO SRC IP DST IP PORT PORT IP COLOR COLOR LOSS LATENCY JITTER INDEX SLA CLASS NAME INDEX ---------------------------------------------------------------------------------------------------------------------------------------- gre 21.1.10.2 21.1.20.2 0 0 1.1.0.20 mpls mpls 0 20 1 0 __all_tunnels__ None gre 21.1.10.2 31.1.20.2 0 0 1.1.0.20 mpls biz-internet 0 20 1 0 __all_tunnels__ None gre 21.1.10.2 41.1.20.2 0 0 1.1.0.20 mpls private1 0 20 1 0 __all_tunnels__ None gre 31.1.10.2 21.1.20.2 0 0 1.1.0.20 biz-internet mpls 0 20 1 0 __all_tunnels__ None gre 31.1.10.2 31.1.20.2 0 0 1.1.0.20 biz-internet biz-internet 0 20 1 0 __all_tunnels__ None gre 31.1.10.2 41.1.20.2 0 0 1.1.0.20 biz-internet private1 0 21 1 0 __all_tunnels__ None gre 41.1.10.2 21.1.20.2 0 0 1.1.0.20 private1 mpls 0 16 0 0 __all_tunnels__ 1 gre 41.1.10.2 31.1.20.2 0 0 1.1.0.20 private1 biz-internet 0 16 0 0 __all_tunnels__ 1 gre 41.1.10.2 41.1.20.2 0 0 1.1.0.20 private1 private1 0 16 0 0 __all_tunnels__ 1 tunnel sla-class 1 sla-name Custom-SLA sla-loss 1 sla-latency 15 sla-jitter 100 BR10# It’s clear that the loss wasn’t used to come up with the BOW, otherwise we would see all the tunnels acting as fallback for SLA Class index 1. Instead, tunnels with lowest latency were selected. Notice that I could have added a latency variance to include other tunnels with similar numbers.\nConclusion Through the last three posts, we have witnessed AAR being a critical SD-WAN functionality to protect the SLA of our applications. I hope that after explaining and verifying different scenarios, you now have a better understanding and feel more confident to try AAR within your SD-WAN infrastructure.. The configuration guide is very complete, so get familiar with it and use it when you need it.\nLet me know your thoughts in the comments.\nSee you soon!\n",
  "wordCount" : "1979",
  "inLanguage": "en",
  "datePublished": "2024-02-11T12:11:06Z",
  "dateModified": "2024-02-11T12:11:06Z",
  "author":{
    "@type": "Person",
    "name": "alex"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/simplifying-aar-3-3-fallback-to-best-path/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "NetWithAlex",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="NetWithAlex (Alt + H)">NetWithAlex</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://netwithalex.blog" title="Home">
                    <span>Home</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/archives/" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/category/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about/" title="About me.">
                    <span>About me.</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="🔍">
                    <span>🔍</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;»&nbsp;<a href="http://localhost:1313/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      Simplifying AAR: 3/3 Fallback to best path
    </h1>
    <div class="post-meta"><span title='2024-02-11 12:11:06 +0000 WET'>February 11, 2024</span>&nbsp;·&nbsp;10 min&nbsp;·&nbsp;alex

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#introduction" aria-label="Introduction">Introduction</a></li>
                <li>
                    <a href="#motivation" aria-label="Motivation">Motivation</a></li>
                <li>
                    <a href="#fallback-to-best-path" aria-label="Fallback to Best Path">Fallback to Best Path</a><ul>
                        
                <li>
                    <a href="#best-of-worst" aria-label="Best of Worst">Best of Worst</a></li>
                <li>
                    <a href="#variance" aria-label="Variance">Variance</a></li></ul>
                </li>
                <li>
                    <a href="#configuration" aria-label="Configuration">Configuration</a><ul>
                        <ul>
                        
                <li>
                    <a href="#sla-class" aria-label="SLA Class">SLA Class</a></li>
                <li>
                    <a href="#aar-policy" aria-label="AAR Policy">AAR Policy</a></li></ul>
                    </ul>
                </li>
                <li>
                    <a href="#scenarios" aria-label="Scenarios">Scenarios</a><ul>
                        <ul>
                        
                <li>
                    <a href="#mpls-compliant-biz-internetprivate1-non-compliant" aria-label="MPLS compliant, Biz-internet/Private1 non-compliant">MPLS compliant, Biz-internet/Private1 non-compliant</a></li>
                <li>
                    <a href="#mplsbiz-inernetprivate1-non-compliant-but-meeting-variance" aria-label="MPLS/Biz-inernet/Private1 non-compliant but meeting variance">MPLS/Biz-inernet/Private1 non-compliant but meeting variance</a></li>
                <li>
                    <a href="#latency-out-of-compliance" aria-label="Latency out of compliance">Latency out of compliance</a></li>
                <li>
                    <a href="#multiple-bow-criteria" aria-label="Multiple BOW criteria">Multiple BOW criteria</a></li></ul>
                    </ul>
                </li>
                <li>
                    <a href="#conclusion" aria-label="Conclusion">Conclusion</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="introduction">Introduction<a hidden class="anchor" aria-hidden="true" href="#introduction">#</a></h2>
<p>For the final post of this series, let&rsquo;s explore the remaining option to handle traffic when SLA is not met: <em>Fallback to best path</em>. It was introduced on 20.5/17.5 and it provides more flexibility and enhanced path selection compared to the other options. Let&rsquo;s understand why it was created.</p>
<h2 id="motivation">Motivation<a hidden class="anchor" aria-hidden="true" href="#motivation">#</a></h2>
<p>With the <a href="/demystifying-aar-understanding-different-scenarios/">previous methods</a>, traffic would either:</p>
<ul>
<li>Be dropped - Rarely used, specific use cases that apply to a small amount of environments.</li>
<li>Be load balanced on the available paths - Widely used, however traffic could be using the worst performing path.</li>
</ul>
<p>Take the following example</p>
<p><img loading="lazy" src="/wp-content/uploads/2024/02/S3-aar.png"></p>
<p>Tunnel 2 is clearly having the worst performance, however with the <em>load balance</em> method, traffic could still use it based on the hashing algorithm. How do we overcome this situation? You probably guessed it: <em><strong>Fallback to best path</strong></em></p>
<h2 id="fallback-to-best-path">Fallback to Best Path<a hidden class="anchor" aria-hidden="true" href="#fallback-to-best-path">#</a></h2>
<p>Let&rsquo;s see how the documentation describes it:</p>
<blockquote>
<p>When the data traffic does not meet any of the SLA class requirements, this feature allows you to select the best tunnel path criteria sequence using the Fallback Best Tunnel.</p>
<p>Cisco SD-WAN Manager uses best of worst (BOW) to find a best tunnel when no tunnel meets any of the SLA class requirements.</p>
<p><a href="https://www.cisco.com/c/en/us/td/docs/routers/sdwan/configuration/policies/ios-xe-17/policies-book-xe/application-aware-routing.html">https://www.cisco.com/c/en/us/td/docs/routers/sdwan/configuration/policies/ios-xe-17/policies-book-xe/application-aware-routing.html</a></p>
</blockquote>
<h3 id="best-of-worst">Best of Worst<a hidden class="anchor" aria-hidden="true" href="#best-of-worst">#</a></h3>
<p>Let&rsquo;s see how BOW works with the following example:</p>
<p><img loading="lazy" src="/wp-content/uploads/2024/02/s3-aar5.png"></p>
<p>The SLA latency requirement is set to 8. None of the tunnels satisfy it, but Tunnel 1 is the closest one, making it the best of worse with a latency of 10.</p>
<p>The criteria(s) to choose the BOW is extremely flexible, in this example we used latency, other options could be:</p>
<ul>
<li>latency - Only latency</li>
<li>jitter - Only jitter</li>
<li>loss - Only loss</li>
<li>latency/jitter - First latency, if they are equal, then jitter</li>
<li>latency/loss - First latency, if they are equal, then loss</li>
<li>jitter/latency - First jitter, if they are equal, then latency</li>
<li>. . .</li>
<li>loss/jitter/latency - First loss, then jitter, then latency</li>
</ul>
<h3 id="variance">Variance<a hidden class="anchor" aria-hidden="true" href="#variance">#</a></h3>
<p>Let&rsquo;s go a step further, Tunnel 3 is also very close to the <em>8 ms</em> latency, it wouldn&rsquo;t be a bad idea to send traffic also on that tunnel. How do we achieve this? Well, we can implement a <em>variance</em> to accommodate small variations when choosing the best paths.</p>
<p>Continuing with this example, let&rsquo;s take a look at the BOW selection with a <code>variance of 5 ms</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span>BOW range <span style="color:#f92672">=</span> (best latency, best latency <span style="color:#f92672">+</span> variance)
</span></span><span style="display:flex;"><span>BOW range <span style="color:#f92672">=</span> (<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">15</span>)
</span></span></code></pre></div><p>The best latency across tunnels is 10 (Tunnel 1), notice this is <strong>not</strong> the latency configured on the SLA. With this variance, if any other tunnel has a latency between 10 - 15, it will also be chosen to send traffic. In our example, Tunnel 3 satisfies the condition, so now Tunnel 1 and Tunnel 3 will be used as <em>Fallback Tunnels</em>.</p>
<p>As you can see, Tunnel 2 is no longer considered. Great!</p>
<h2 id="configuration">Configuration<a hidden class="anchor" aria-hidden="true" href="#configuration">#</a></h2>
<h4 id="sla-class">SLA Class<a hidden class="anchor" aria-hidden="true" href="#sla-class">#</a></h4>
<p>To use this method, the first thing we need to do is modify our sla-class to indicate that it should look for the best performing path when SLA is not met. Our configuration looks like this:</p>
<p><img loading="lazy" src="/wp-content/uploads/2024/02/s3-aar7.png"></p>
<hr>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span>sla<span style="color:#f92672">-</span><span style="color:#66d9ef">class</span> Custom<span style="color:#f92672">-</span>SLA
</span></span><span style="display:flex;"><span> loss    <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span> latency <span style="color:#ae81ff">250</span>
</span></span><span style="display:flex;"><span> jitter  <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span> fallback<span style="color:#f92672">-</span>best<span style="color:#f92672">-</span>tunnel
</span></span><span style="display:flex;"><span>  criteria loss
</span></span><span style="display:flex;"><span>  loss<span style="color:#f92672">-</span>variance <span style="color:#ae81ff">2</span>
</span></span></code></pre></div><p>Notice we selected the <em>Criteria</em> to be <code>Loss</code> and a <em>variance</em> of <code>2</code>. Variance is an <strong>optional</strong> parameter.</p>
<h4 id="aar-policy">AAR Policy<a hidden class="anchor" aria-hidden="true" href="#aar-policy">#</a></h4>
<p>Next, on the AAR policy we specify the action when SLA is not met: <em>Fallback to Best path</em></p>
<p><img loading="lazy" src="/wp-content/uploads/2024/02/S3-AAR22.png"></p>
<hr>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>sequence 1
</span></span><span style="display:flex;"><span> match
</span></span><span style="display:flex;"><span>  source-ip 172.16.10.0/24
</span></span><span style="display:flex;"><span>  destination-ip 172.16.20.0/24
</span></span><span style="display:flex;"><span> action
</span></span><span style="display:flex;"><span>  sla-class Custom-SLA
</span></span><span style="display:flex;"><span>  no sla-class strict
</span></span><span style="display:flex;"><span>  sla-class preferred-color mpls
</span></span><span style="display:flex;"><span>  sla-class fallback-to-best-path
</span></span></code></pre></div><p>Let&rsquo;s keep the same dynamic and build a diagram:</p>
<p><img loading="lazy" src="/wp-content/uploads/2024/02/s3-aar8.png"></p>
<h2 id="scenarios">Scenarios<a hidden class="anchor" aria-hidden="true" href="#scenarios">#</a></h2>
<p>Using the same topology let&rsquo;s explore some situations</p>
<p><img loading="lazy" src="/wp-content/uploads/2024/02/AAR-Topo2.png"></p>
<h4 id="mpls-compliant-biz-internetprivate1-non-compliant">MPLS compliant, Biz-internet/Private1 non-compliant<a hidden class="anchor" aria-hidden="true" href="#mpls-compliant-biz-internetprivate1-non-compliant">#</a></h4>
<p>I will initiate traffic from Branch10 -&gt; Branch 20 and capture it with NWPI. MPLS has perfect KPI metrics (0, 0, 0)</p>
<p><img loading="lazy" src="/wp-content/uploads/2024/02/s3-aar1-1-1.png"></p>
<p>Notice how <em>fallback to best path</em> is set to <code>no</code> and traffic is matching the SLA and preferred color. Let&rsquo;s also see the following verification command from BR10.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>BR10#show sdwan tunnel sla
</span></span><span style="display:flex;"><span>&lt;. . .&gt;
</span></span><span style="display:flex;"><span>tunnel sla-class 1
</span></span><span style="display:flex;"><span> sla-name    Custom-SLA
</span></span><span style="display:flex;"><span> sla-loss    1
</span></span><span style="display:flex;"><span> sla-latency 250
</span></span><span style="display:flex;"><span> sla-jitter  100
</span></span><span style="display:flex;"><span>                                                                                                                                   FALLBACK
</span></span><span style="display:flex;"><span>                                         REMOTE    T                                           SLA                                 SLA
</span></span><span style="display:flex;"><span>                             SRC   DST   SYSTEM    LOCAL  T REMOTE      MEAN  MEAN     MEAN    CLASS                               CLASS
</span></span><span style="display:flex;"><span>PROTO  SRC IP     DST IP     PORT  PORT  IP        COLOR  COLOR         LOSS  LATENCY  JITTER  INDEX  SLA CLASS NAME               INDEX
</span></span><span style="display:flex;"><span>---------------------------------------------------------------------------------------------------------------------------------------------
</span></span><span style="display:flex;"><span>gre    21.1.10.2  21.1.20.2  0     0     1.1.0.20  mpls   mpls          0     0        0       0,1    __all_tunnels__, Custom-SLA  None
</span></span><span style="display:flex;"><span>gre    21.1.10.2  31.1.20.2  0     0     1.1.0.20  mpls   biz-internet  0     0        0       0,1    __all_tunnels__, Custom-SLA  None
</span></span><span style="display:flex;"><span>gre    21.1.10.2  41.1.20.2  0     0     1.1.0.20  mpls   private1      0     0        0       0,1    __all_tunnels__, Custom-SLA  None
</span></span></code></pre></div><p>Some comments about this output:</p>
<ol>
<li>The fact that we see tunnels listed under Custom-SLA, tells us that there are tunnels meeting the loss, latency and jitter. This is expected as our MPLS is having perfect metrics.</li>
<li>See that this sla-class has a numeric identifier of 1 - <code>tunnel sla-class 1</code>. You will see reference to this number shortly.</li>
<li><em>Fallback SLA class index</em> is set to <code>none</code>, this mean that these tunnels are not being used as fallback tunnels, this will become clear in a second.</li>
</ol>
<h4 id="mplsbiz-inernetprivate1-non-compliant-but-meeting-variance">MPLS/Biz-inernet/Private1 non-compliant but meeting variance<a hidden class="anchor" aria-hidden="true" href="#mplsbiz-inernetprivate1-non-compliant-but-meeting-variance">#</a></h4>
<p>Now that we have no transports meeting the SLA, let&rsquo;s check how NWPI will show it:</p>
<p><img loading="lazy" src="/wp-content/uploads/2024/02/s3-aar10.png"></p>
<p>Notice that now NWPI is indicating that <em>Fallback to Best Path</em> is in use.</p>
<p>Private1 was chosen to send this particular flow, but are there any other tunnels that could be used? Let&rsquo;s check BR10 again.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>BR10# show sdwan tunnel sla
</span></span><span style="display:flex;"><span>tunnel sla-class 0
</span></span><span style="display:flex;"><span> sla-name    __all_tunnels__
</span></span><span style="display:flex;"><span> sla-loss    0
</span></span><span style="display:flex;"><span> sla-latency 0
</span></span><span style="display:flex;"><span> sla-jitter  0
</span></span><span style="display:flex;"><span>                                                                                                                              FALLBACK
</span></span><span style="display:flex;"><span>                                         REMOTE                                                       SLA                     SLA
</span></span><span style="display:flex;"><span>                             SRC   DST   SYSTEM    T LOCAL       T REMOTE      MEAN  MEAN     MEAN    CLASS                   CLASS
</span></span><span style="display:flex;"><span>PROTO  SRC IP     DST IP     PORT  PORT  IP        COLOR         COLOR         LOSS  LATENCY  JITTER  INDEX  SLA CLASS NAME   INDEX
</span></span><span style="display:flex;"><span>----------------------------------------------------------------------------------------------------------------------------------------
</span></span><span style="display:flex;"><span>gre    21.1.10.2  21.1.20.2  0     0     1.1.0.20  mpls          mpls          18    0        0       0      __all_tunnels__  None
</span></span><span style="display:flex;"><span>gre    21.1.10.2  31.1.20.2  0     0     1.1.0.20  mpls          biz-internet  9     0        0       0      __all_tunnels__  None
</span></span><span style="display:flex;"><span>gre    21.1.10.2  41.1.20.2  0     0     1.1.0.20  mpls          private1      11    0        0       0      __all_tunnels__  None
</span></span><span style="display:flex;"><span>gre    31.1.10.2  21.1.20.2  0     0     1.1.0.20  biz-internet  mpls          4     0        0       0      __all_tunnels__  1
</span></span><span style="display:flex;"><span>gre    31.1.10.2  31.1.20.2  0     0     1.1.0.20  biz-internet  biz-internet  2     0        0       0      __all_tunnels__  1
</span></span><span style="display:flex;"><span>gre    31.1.10.2  41.1.20.2  0     0     1.1.0.20  biz-internet  private1      4     0        0       0      __all_tunnels__  1
</span></span><span style="display:flex;"><span>gre    41.1.10.2  21.1.20.2  0     0     1.1.0.20  private1      mpls          3     0        0       0      __all_tunnels__  1
</span></span><span style="display:flex;"><span>gre    41.1.10.2  31.1.20.2  0     0     1.1.0.20  private1      biz-internet  6     0        0       0      __all_tunnels__  None
</span></span><span style="display:flex;"><span>gre    41.1.10.2  41.1.20.2  0     0     1.1.0.20  private1      private1      3     0        0       0      __all_tunnels__  1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>tunnel sla-class 1
</span></span><span style="display:flex;"><span> sla-name    Custom-SLA
</span></span><span style="display:flex;"><span> sla-loss    1
</span></span><span style="display:flex;"><span> sla-latency 250
</span></span><span style="display:flex;"><span> sla-jitter  100
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>BR10#
</span></span></code></pre></div><p>Comments about this output:</p>
<ol>
<li>There are <strong>no</strong> tunnels meeting our <em>Custom-SLA</em></li>
<li>Even if MPLS is the preferred color, it is <strong>not</strong> considered because it doesn&rsquo;t meet the loss variance range.</li>
<li>There are 5 tunnels that satisfy the variance. Notice how some tunnels have <em>Fallback SLA class index</em> set to <code>1</code>, meaning that they are serving as fallback for sla-class 1 (Custom-SLA). In this case the <strong>BOW</strong> is <em>biz-internet - biz-internet</em> tunnel with a mean loss of <code>2</code>. The <em>variance</em> is set to 2, so BOW range is 2-4. Tunnels satisfying the BOW range, will be used to forward traffic as well.</li>
</ol>
<p>Depending on the load-balance hash, different tunnels will be chosen</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>BR10#show sdwan policy service-path vpn 10 interface GigabitEthernet 3 source-ip 172.16.10.2 dest-ip 172.16.20.2 protocol 6 dest-port 22
</span></span><span style="display:flex;"><span>Next Hop: GRE
</span></span><span style="display:flex;"><span>  Source: 31.1.10.2 Destination: 21.1.20.2 Local Color: biz-internet Remote Color: mpls Remote System IP: 1.1.0.20
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>BR10#show sdwan policy service-path vpn 10 interface GigabitEthernet 3 source-ip 172.16.10.56 dest-ip 172.16.20.2 protocol 6 dest-port 24
</span></span><span style="display:flex;"><span>Next Hop: GRE
</span></span><span style="display:flex;"><span>  Source: 31.1.10.2 Destination: 41.1.20.2 Local Color: biz-internet Remote Color: private1 Remote System IP: 1.1.0.20
</span></span></code></pre></div><p>We can see two different tunnels <code>biz-internet - mpls</code> and <code>biz-internet - private</code></p>
<h4 id="latency-out-of-compliance">Latency out of compliance<a hidden class="anchor" aria-hidden="true" href="#latency-out-of-compliance">#</a></h4>
<p>So far we have been playing only with loss, because the fallback criteria was set to loss. Let&rsquo;s see what happens when a different criteria goes out of compliance. I will set the latency of the SLA to 15 ms. .</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span>BR10<span style="color:#75715e">#show sdwan policy from-vsmart</span>
</span></span><span style="display:flex;"><span>from<span style="color:#f92672">-</span>vsmart sla<span style="color:#f92672">-</span><span style="color:#66d9ef">class</span> Custom<span style="color:#f92672">-</span>SLA
</span></span><span style="display:flex;"><span> loss    <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span> latency <span style="color:#ae81ff">15</span>
</span></span><span style="display:flex;"><span> jitter  <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span> fallback<span style="color:#f92672">-</span>best<span style="color:#f92672">-</span>tunnel
</span></span><span style="display:flex;"><span>  criteria      loss
</span></span><span style="display:flex;"><span>  loss<span style="color:#f92672">-</span>variance <span style="color:#ae81ff">2</span>
</span></span></code></pre></div><p>After introducing some latency, we see something interesting:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>BR10#show sdwan tunnel sla
</span></span><span style="display:flex;"><span>tunnel sla-class 0
</span></span><span style="display:flex;"><span> sla-name    __all_tunnels__
</span></span><span style="display:flex;"><span> sla-loss    0
</span></span><span style="display:flex;"><span> sla-latency 0
</span></span><span style="display:flex;"><span> sla-jitter  0
</span></span><span style="display:flex;"><span>                                                                                                                              FALLBACK
</span></span><span style="display:flex;"><span>                                         REMOTE                                                       SLA                     SLA
</span></span><span style="display:flex;"><span>                             SRC   DST   SYSTEM    T LOCAL       T REMOTE      MEAN  MEAN     MEAN    CLASS                   CLASS
</span></span><span style="display:flex;"><span>PROTO  SRC IP     DST IP     PORT  PORT  IP        COLOR         COLOR         LOSS  LATENCY  JITTER  INDEX  SLA CLASS NAME   INDEX
</span></span><span style="display:flex;"><span>----------------------------------------------------------------------------------------------------------------------------------------
</span></span><span style="display:flex;"><span>gre    21.1.10.2  21.1.20.2  0     0     1.1.0.20  mpls          mpls          0     20       1       0      __all_tunnels__  1
</span></span><span style="display:flex;"><span>gre    21.1.10.2  31.1.20.2  0     0     1.1.0.20  mpls          biz-internet  0     20       1       0      __all_tunnels__  1
</span></span><span style="display:flex;"><span>gre    21.1.10.2  41.1.20.2  0     0     1.1.0.20  mpls          private1      0     20       0       0      __all_tunnels__  1
</span></span><span style="display:flex;"><span>gre    31.1.10.2  21.1.20.2  0     0     1.1.0.20  biz-internet  mpls          0     21       2       0      __all_tunnels__  1
</span></span><span style="display:flex;"><span>gre    31.1.10.2  31.1.20.2  0     0     1.1.0.20  biz-internet  biz-internet  0     21       2       0      __all_tunnels__  1
</span></span><span style="display:flex;"><span>gre    31.1.10.2  41.1.20.2  0     0     1.1.0.20  biz-internet  private1      0     21       2       0      __all_tunnels__  1
</span></span><span style="display:flex;"><span>gre    41.1.10.2  21.1.20.2  0     0     1.1.0.20  private1      mpls          0     16       1       0      __all_tunnels__  1
</span></span><span style="display:flex;"><span>gre    41.1.10.2  31.1.20.2  0     0     1.1.0.20  private1      biz-internet  0     16       0       0      __all_tunnels__  1
</span></span><span style="display:flex;"><span>gre    41.1.10.2  41.1.20.2  0     0     1.1.0.20  private1      private1      0     16       0       0      __all_tunnels__  1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>tunnel sla-class 1
</span></span><span style="display:flex;"><span> sla-name    Custom-SLA
</span></span><span style="display:flex;"><span> sla-loss    1
</span></span><span style="display:flex;"><span> sla-latency 15
</span></span><span style="display:flex;"><span> sla-jitter  100
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>BR10#
</span></span></code></pre></div><p>All of the tunnels are used as fallback tunnels because all of them have 0% loss! Is this the ideal situation? This is arguable, maybe for some types of traffic it&rsquo;s fine, but for others you probably want to have a second or third criteria to pick the best fallback tunnels.</p>
<h4 id="multiple-bow-criteria">Multiple BOW criteria<a hidden class="anchor" aria-hidden="true" href="#multiple-bow-criteria">#</a></h4>
<p>For the last test, let&rsquo;s see what happens when we select multiple criteria to select the BOW. I will add latency to the SLA criteria.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span>BR10<span style="color:#75715e">#show sdwan policy from-vsmart</span>
</span></span><span style="display:flex;"><span>from<span style="color:#f92672">-</span>vsmart sla<span style="color:#f92672">-</span><span style="color:#66d9ef">class</span> Custom<span style="color:#f92672">-</span>SLA
</span></span><span style="display:flex;"><span> loss    <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span> latency <span style="color:#ae81ff">15</span>
</span></span><span style="display:flex;"><span> jitter  <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span> fallback<span style="color:#f92672">-</span>best<span style="color:#f92672">-</span>tunnel
</span></span><span style="display:flex;"><span>  criteria      loss latency
</span></span><span style="display:flex;"><span>  loss<span style="color:#f92672">-</span>variance <span style="color:#ae81ff">2</span>
</span></span></code></pre></div><p>What we expect is that if any of the KPIs go out of compliance, the BOW will be decided based on:</p>
<ol>
<li>Lowest mean loss. If there is a tie, then</li>
<li>Lowest latency</li>
</ol>
<p>Let&rsquo;s verify</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>BR10#show sdwan tunnel sla
</span></span><span style="display:flex;"><span>tunnel sla-class 0
</span></span><span style="display:flex;"><span> sla-name    __all_tunnels__
</span></span><span style="display:flex;"><span> sla-loss    0
</span></span><span style="display:flex;"><span> sla-latency 0
</span></span><span style="display:flex;"><span> sla-jitter  0
</span></span><span style="display:flex;"><span>                                                                                                                              FALLBACK
</span></span><span style="display:flex;"><span>                                         REMOTE                                                       SLA                     SLA
</span></span><span style="display:flex;"><span>                             SRC   DST   SYSTEM    T LOCAL       T REMOTE      MEAN  MEAN     MEAN    CLASS                   CLASS
</span></span><span style="display:flex;"><span>PROTO  SRC IP     DST IP     PORT  PORT  IP        COLOR         COLOR         LOSS  LATENCY  JITTER  INDEX  SLA CLASS NAME   INDEX
</span></span><span style="display:flex;"><span>----------------------------------------------------------------------------------------------------------------------------------------
</span></span><span style="display:flex;"><span>gre    21.1.10.2  21.1.20.2  0     0     1.1.0.20  mpls          mpls          0     20       1       0      __all_tunnels__  None
</span></span><span style="display:flex;"><span>gre    21.1.10.2  31.1.20.2  0     0     1.1.0.20  mpls          biz-internet  0     20       1       0      __all_tunnels__  None
</span></span><span style="display:flex;"><span>gre    21.1.10.2  41.1.20.2  0     0     1.1.0.20  mpls          private1      0     20       1       0      __all_tunnels__  None
</span></span><span style="display:flex;"><span>gre    31.1.10.2  21.1.20.2  0     0     1.1.0.20  biz-internet  mpls          0     20       1       0      __all_tunnels__  None
</span></span><span style="display:flex;"><span>gre    31.1.10.2  31.1.20.2  0     0     1.1.0.20  biz-internet  biz-internet  0     20       1       0      __all_tunnels__  None
</span></span><span style="display:flex;"><span>gre    31.1.10.2  41.1.20.2  0     0     1.1.0.20  biz-internet  private1      0     21       1       0      __all_tunnels__  None
</span></span><span style="display:flex;"><span>gre    41.1.10.2  21.1.20.2  0     0     1.1.0.20  private1      mpls          0     16       0       0      __all_tunnels__  1
</span></span><span style="display:flex;"><span>gre    41.1.10.2  31.1.20.2  0     0     1.1.0.20  private1      biz-internet  0     16       0       0      __all_tunnels__  1
</span></span><span style="display:flex;"><span>gre    41.1.10.2  41.1.20.2  0     0     1.1.0.20  private1      private1      0     16       0       0      __all_tunnels__  1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>tunnel sla-class 1
</span></span><span style="display:flex;"><span> sla-name    Custom-SLA
</span></span><span style="display:flex;"><span> sla-loss    1
</span></span><span style="display:flex;"><span> sla-latency 15
</span></span><span style="display:flex;"><span> sla-jitter  100
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>BR10#
</span></span></code></pre></div><p>It&rsquo;s clear that the loss wasn&rsquo;t used to come up with the BOW, otherwise we would see all the tunnels acting as fallback for SLA Class index 1. Instead, tunnels with lowest latency were selected. Notice that I could have added a latency variance to include other tunnels with similar numbers.</p>
<h2 id="conclusion">Conclusion<a hidden class="anchor" aria-hidden="true" href="#conclusion">#</a></h2>
<p>Through the last three posts, we have witnessed AAR being a critical SD-WAN functionality to protect the SLA of our applications. I hope that after explaining and verifying different scenarios, you now have a better understanding and feel more confident to try AAR within your SD-WAN infrastructure.. The <a href="https://www.cisco.com/c/en/us/td/docs/routers/sdwan/configuration/policies/ios-xe-17/policies-book-xe/application-aware-routing.html#config-variance-best-tunnel-path">configuration guide</a> is very complete, so get familiar with it and use it when you need it.</p>
<p>Let me know your thoughts in the comments.</p>
<p>See you soon!</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">NetWithAlex</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
